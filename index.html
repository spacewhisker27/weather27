<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Weather Dashboard</title>
  <style>
    :root {
      --bg-body:#f2f4f8;
      --bg-card:#ffffff;
      --clr-text-light:#6b7280;
      --clr-text-dark:#111827;
      --radius:1rem;
      --shadow:0 4px 12px rgba(0,0,0,0.08);
      --accent-good:#22c55e;
      --accent-bad:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:"Segoe UI",sans-serif;background:var(--bg-body);display:flex;flex-direction:column;align-items:center;padding:2rem 1rem 4rem;min-height:100vh;}
    h1{font-size:clamp(1.5rem,2vw+1rem,2.25rem);font-weight:600;color:var(--clr-text-dark);margin-bottom:1.5rem;text-align:center;}

    #forecastBar{width:100%;max-width:1200px;background:var(--bg-card);border-radius:var(--radius);box-shadow:var(--shadow);padding:1rem 1.5rem;margin-bottom:1.5rem;font-size:1.15rem;font-weight:600;text-align:center;transition:color .3s ease;}
    #forecastBar.good{color:var(--accent-good);}#forecastBar.bad{color:var(--accent-bad);}#forecastBar.neutral{color:var(--clr-text-dark);}

    .dashboard{width:100%;max-width:1200px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.25rem;}
    .card{background:var(--bg-card);border-radius:var(--radius);box-shadow:var(--shadow);padding:1.25rem 1rem;display:flex;flex-direction:column;align-items:center;transition:transform .2s ease;}
    .card:hover{transform:translateY(-4px);}
    .label{font-size:.85rem;color:var(--clr-text-light);text-transform:uppercase;letter-spacing:.03em;margin-bottom:.15rem;text-align:center;}
    .value{font-size:2.25rem;font-weight:700;color:var(--clr-text-dark);text-align:center;}
    .unit{font-size:.85rem;color:var(--clr-text-light);margin-top:.15rem;text-align:center;}
    .subtext{font-size:.8rem;color:var(--clr-text-light);margin-top:.1rem;text-align:center;}
    @keyframes glow{from{box-shadow:0 0 8px rgba(255,196,0,.6);}to{box-shadow:0 0 16px rgba(255,196,0,1);}}
    .highlight{animation:glow 1.6s infinite alternate;}
    footer{margin-top:2.5rem;font-size:.9rem;color:var(--clr-text-light);text-align:center;}
  </style>
</head>
<body>
  <h1>Live Weather Dashboard</h1>
  <div id="forecastBar" class="neutral">Calculating forecast…</div>
  <main class="dashboard">
    <div class="card" id="temperatureCard"><span class="label">Temperature</span><span class="value" id="temperature">--</span><span class="unit">°C</span><span class="subtext" id="tempExtremes">H --°C (--) / L --°C (--)</span></div>
    <div class="card" id="dewPointCard"><span class="label">Dew Point</span><span class="value" id="dewPoint">--</span><span class="unit">°C</span></div>
    <div class="card" id="humidityCard"><span class="label">Humidity</span><span class="value" id="humidity">--</span><span class="unit">%</span><span class="subtext" id="humExtremes">H --% (--) / L --% (--)</span></div>
    <div class="card" id="windCard"><span class="label">Wind</span><span class="value" id="wind">--</span><span class="unit">km/h</span><span class="subtext" id="windDir">--</span><span class="subtext" id="windGust">Gust -- km/h</span></div>
    <div class="card" id="rainCard"><span class="label">Precipitation</span><span class="value" id="rain">--</span><span class="unit">mm/hr</span><span class="subtext" id="rainDaily">Daily -- mm</span><span class="subtext" id="rainMonthly">Monthly -- mm</span></div>
    <div class="card" id="pressureCard"><span class="label">Pressure</span><span class="value" id="pressure">--</span><span class="unit">hPa</span></div>
    <div class="card" id="uvCard"><span class="label">UV Index</span><span class="value" id="uv">--</span><span class="unit">index</span></div>
    <div class="card" id="radiationCard"><span class="label">Radiation</span><span class="value" id="radiation">--</span><span class="unit">W/m²</span></div>
  </main>
  <footer id="updatedAt">Updated: --</footer>

<script>
/***** Helper functions *****/
const f2c = f=>((parseFloat(f)-32)*5/9).toFixed(1);
const inHg2hPa = x=>(parseFloat(x)*33.8639).toFixed(2);
const mph2kph = m=>(parseFloat(m)*1.60934).toFixed(1);
const ins2mm = i=>(parseFloat(i)*25.4).toFixed(1);
const deg2comp = d=>['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'][Math.round(d/22.5)%16];
const tsTime = t=> t? new Date(t*1000).toLocaleTimeString('en-PH',{hour:'numeric',minute:'2-digit',hour12:true}) : '--';
const tsDate = t=> t? new Date(t*1000).toLocaleString('en-PH',{year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'2-digit',hour12:true}) : '--';

/***** Extremes fetch using history API *****/
async function fetchExtremes(){
  try{
    const today = new Date();
    const ymd = today.toISOString().split('T')[0]; // YYYY-MM-DD
    // Per Ecowitt v3 docs page 19: /v3/device/history?date=YYYY-MM-DD&type=day
    const url = `https://weatherstation.bryanespano7.workers.dev/history?date=${ymd}&type=day`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('history fetch failed');
    const js = await res.json();
    /* Expected structure
       js.data.temp_max, temp_max_time, temp_min, temp_min_time, hum_max, hum_max_time, hum_min, hum_min_time
       Adjust below if actual keys differ.
    */
    const ex = js.data;
    const tempMax = ex.temp_max; const tempMaxT = ex.temp_max_time;
    const tempMin = ex.temp_min; const tempMinT = ex.temp_min_time;
    const humMax  = ex.hum_max;  const humMaxT  = ex.hum_max_time;
    const humMin  = ex.hum_min;  const humMinT  = ex.hum_min_time;

    document.getElementById('tempExtremes').textContent =
      `H ${tempMax? tempMax.toFixed(1)+'°C ('+tsTime(tempMaxT)+')':'--'} / L ${tempMin? tempMin.toFixed(1)+'°C ('+tsTime(tempMinT)+')':'--'}`;
    document.getElementById('humExtremes').textContent =
      `H ${humMax??'--'}% (${tsTime(humMaxT)}) / L ${humMin??'--'}% (${tsTime(humMinT)})`;

  }catch(e){console.warn('extremes unavailable',e);} }

/***** fetchData (real‑time) omitted for brevity, keep existing logic *****/

// existing fetchData() function here ...

fetchData();
fetchExtremes();
setInterval(fetchData,60_000);
// refresh extremes every hour
setInterval(fetchExtremes,60*60*1000);
</script>
</body>
</html>
